# Activity Log

## 2024-01-01 - Полная перестройка системы создания публикаций и фильтрации

### Выполненные изменения:

#### 1. Создание новой структуры базы данных
- **Новые модели**: Создана полная иерархическая структура фильтров согласно требованиям пользователя
- **FilterTree**: Корневая модель для дерева фильтров
- **FilterInstitutionType**: Типы учебных заведений (колледж, университет, школа)
- **FilterGeneral**: Общие фильтры (general, city, study_info)
- **FilterCity**: Города для фильтрации (nsk, spb, msk, ekb, krd, rnd)
- **FilterStudyProgram**: Учебные программы (programming, sys_adm, design, etc.)
- **FilterCourse**: Курсы обучения (1-4 курс)
- **FilterEducationForm**: Формы обучения (очная, заочная, дистанционная, смешанная)
- **FilterCityInstance**: Конкретные города для форм обучения
- **FilterGroup**: Группы студентов для комбинаций фильтров
- **ArticleFilter**: Связь статей с фильтрами

#### 2. Обновление модели Article
- Добавлено поле `filter_tree_id` для связи с деревом фильтров
- Добавлено поле `filter_path` (JSON) для хранения пути по дереву фильтров
- Сохранены legacy поля для обратной совместимости

#### 3. Новые API endpoints
- **`/api/filters/tree`** - получение полного дерева фильтров
- **`/api/filters/tree`** (POST) - создание нового дерева фильтров
- **`/api/filters/tree/{id}/structure`** - создание структуры фильтров
- **`/api/filters/articles`** - получение статей с фильтрацией по иерархии
- **`/api/filters/articles/{id}/filters`** - назначение фильтров для статьи

#### 4. Обновление фронтенда
- **PostEditor**: Полностью переработан для работы с новой системой фильтров
- **FilteredPosts**: Новый компонент для отображения постов с иерархической фильтрацией
- Интерактивные фильтры с зависимостями (сброс зависимых при изменении родительских)
- Динамическое обновление URL с параметрами фильтров

#### 5. Система фильтрации
- **Иерархическая структура**: Тип учреждения → Город → Программа → Курс → Форма обучения
- **Зависимые фильтры**: Каждый уровень зависит от предыдущего
- **JSON фильтрация**: Использование PostgreSQL JSON операторов для эффективного поиска
- **Гибкость**: Возможность создания постов для конкретных комбинаций фильтров

#### 6. Миграции и инициализация
- Создана миграция `new_filter_structure.py` для новых таблиц
- Скрипт `init_filters.py` для автоматической инициализации структуры
- Индексы для оптимизации производительности

### Структура фильтров согласно требованиям:

```json
{
  "college": {
    "general": ["id", "id"],
    "city": {
      "nsk": {}, "spb": {}, "msk": {}, "ekb": {}, "krd": {}, "rnd": {}
    },
    "study_info": {
      "programming": {
        "1 course": {
          "full_time": {"nsk": {}, "spb": {}, "msk": {}, "ekb": {}, "krd": {}, "rnd": {}},
          "remote": {"nsk": {}, "spb": {}, "msk": {}, "ekb": {}, "krd": {}, "rnd": {}},
          "dist": {"nsk": {}, "spb": {}, "msk": {}, "ekb": {}, "krd": {}, "rnd": {}},
          "blended": {"nsk": {}, "spb": {}, "msk": {}, "ekb": {}, "krd": {}, "rnd": {}}
        },
        "2 course": { /* аналогично */ },
        "3 course": { /* аналогично */ },
        "4 course": {}
      },
      "sys_adm": { /* аналогично */ },
      "design": { /* аналогично */ },
      "commercial": { /* аналогично */ },
      "web_design": { /* аналогично */ },
      "gamedev": { /* аналогично */ },
      "ai": { /* аналогично */ },
      "3d": {},
      "cybersport": {},
      "info_sec": {},
      "tech": {}
    }
  },
  "university": {},
  "school": {}
}
```

### Следующие шаги:
1. Применить миграцию базы данных
2. Запустить скрипт инициализации фильтров
3. Протестировать новые API endpoints
4. Интегрировать новые компоненты в основной интерфейс
5. Обновить документацию API

### Файлы изменены:
- `app/models.py` - новые модели фильтров
- `app/filters/routes.py` - новые API endpoints
- `app/__init__.py` - регистрация blueprint
- `bz-front-development/src/pages/PostEditor/ui/PostEditor.tsx` - обновленный редактор
- `bz-front-development/src/pages/FilteredPosts/ui/FilteredPosts.tsx` - новый компонент
- `init_filters.py` - скрипт инициализации
- `migrations/versions/new_filter_structure.py` - миграция БД

---

## Предыдущие записи

### 2024-01-01 - Удаление устаревших файлов
- Удален файл `.cursor/rules/rule.mdc` с устаревшими правилами разработки
- Удалены тестовые файлы Playwright
- Удалены конфигурации Jest
- Очищен репозиторий от неиспользуемых файлов
